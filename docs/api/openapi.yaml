openapi: 3.1.0
info:
  title: Lumi Backend API
  version: 1.0.0
  description: Express API baseline for the Lumi commerce platform. The documentation reflects the Phase 1 middleware and
    health endpoints.
  contact:
    name: Lumi Platform Engineering
    email: engineering@lumi.example
  license:
    name: Proprietary - Lumi Internal Use Only
    identifier: LicenseRef-Lumi-Internal
servers:
  - url: http://localhost:4100/api
    description: Primary API entrypoint
  - url: https://api.lumi-commerce.com/api
    description: Production
  - url: https://staging-api.lumi-commerce.com/api
    description: Staging
  - url: http://localhost:4000/api
    description: Local development
tags:
  - name: Health
    description: Service health and readiness checks.
  - name: Observability
    description: Internal observability surfaces including metrics and diagnostics.
  - name: Admin
    description: Administrative endpoints reserved for authorised operators. Currently guarded with strict 403 responses
      until RBAC is implemented.
  - name: Catalog
    description: Product catalogue browsing endpoints.
  - name: Auth
    description: Authentication, session management, and RBAC-protected endpoints.
  - name: Cart
    description: Persistent shopping cart operations.
  - name: Orders
    description: Order lifecycle, payments, and tracking endpoints.
  - name: Users
    description: Customer self-service profile, address, and preference APIs.
  - name: Media
    description: Media library operations, Cloudinary delivery, and administrative asset controls.
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Reserved for authenticated endpoints. Full RBAC enforcement will arrive in Phase 3.
    serviceToken:
      type: apiKey
      in: header
      name: X-Service-Token
      description: Service-to-service authentication placeholder. Exact contract will be finalised in Phase 2.
    basicAuth:
      type: http
      scheme: basic
      description: Used for internal-only endpoints such as metrics collection.
  headers:
    X-RateLimit-Limit:
      description: Maximum number of requests allowed within the active window.
      schema:
        type: integer
    X-RateLimit-Remaining:
      description: Remaining requests before throttling begins.
      schema:
        type: integer
    X-RateLimit-Reset:
      description: UNIX epoch (seconds) when the bucket resets.
      schema:
        type: integer
        format: int64
    Retry-After:
      description: Seconds until the client may safely retry.
      schema:
        type: integer
  parameters:
    RequestIdHeader:
      name: X-Request-Id
      in: header
      description: Optional idempotency token supplied by clients.
      schema:
        type: string
        format: uuid
    ProductSlug:
      name: slug
      in: path
      required: true
      schema:
        type: string
    ProductId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: cuid
    VariantId:
      name: variantId
      in: path
      required: true
      schema:
        type: string
        format: cuid
    CategorySlug:
      name: slug
      in: path
      required: true
      schema:
        type: string
    CategoryId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: cuid
    OrderId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: cuid
    OrderReference:
      name: reference
      in: path
      required: true
      schema:
        type: string
    CartItemId:
      name: itemId
      in: path
      required: true
      schema:
        type: string
        format: cuid
    AddressId:
      name: addressId
      in: path
      required: true
      schema:
        type: string
        format: cuid
    UserId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: cuid
    MediaId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: cuid
  examples:
    StandardSuccess:
      summary: Success envelope
      value:
        success: true
        data: {}
        meta:
          timestamp: 2025-10-01T12:00:00Z
          requestId: 5a8f4ec3-5c58-4f08-8200-0b2fd299e9e0
    ValidationError:
      summary: Validation failure
      value:
        success: false
        error:
          code: VALIDATION_ERROR
          message: Invalid request parameters
          details:
            - field: title
              message: Title must be at least 3 characters long.
        meta:
          timestamp: 2025-10-01T12:00:00Z
          requestId: 0c1eaa62-df05-4cf3-8f42-5d3fd20f27d1
    MediaListSuccess:
      summary: Paginated media assets
      value:
        success: true
        data:
          - id: cm2x1y2z3
            publicId: lumi/products/board-001
            url: https://res.cloudinary.com/lumi/image/upload/v1727704823/lumi/products/board-001.jpg
            secureUrl: https://res.cloudinary.com/lumi/image/upload/v1727704823/lumi/products/board-001.jpg
            folder: lumi/products
            format: jpg
            resourceType: image
            type: upload
            width: 1920
            height: 1080
            bytes: 245678
            tags:
              - product:cm2a0b1c2
              - hero
            metadata:
              alt: Carbon desk with walnut legs
              dominantColor: "#3B82F6"
              blurDataUrl: data:image/webp;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAFElEQVQoU2NkQAL+/v7/Bw4cOADzCQ4GT5GpewAAAABJRU5ErkJggg==
            version: 3
            visibility: public
            transformations:
              original: https://res.cloudinary.com/lumi/image/upload/v1727704823/lumi/products/board-001.jpg
              thumbnail: https://res.cloudinary.com/lumi/image/upload/c_fill,w_300,h_300/v1727704823/lumi/products/board-001.jpg
              medium: https://res.cloudinary.com/lumi/image/upload/c_limit,w_800/v1727704823/lumi/products/board-001.jpg
              large: https://res.cloudinary.com/lumi/image/upload/c_limit,w_1920/v1727704823/lumi/products/board-001.jpg
              responsive_640: https://res.cloudinary.com/lumi/image/upload/c_limit,w_640/v1727704823/lumi/products/board-001.jpg
            usage:
              products:
                - id: cm2a0b1c2
                  title: Carbon Desk
                  slug: carbon-desk
              variants:
                - id: cm2a0b1v0
                  sku: CARBON-DESK-STD
                  productId: cm2a0b1c2
            createdAt: 2025-09-29T10:01:08.000Z
            updatedAt: 2025-09-29T10:01:08.000Z
        meta:
          pagination:
            totalItems: 42
            page: 1
            pageSize: 24
            totalPages: 2
            hasNextPage: true
            hasPreviousPage: false
    MediaUploadSuccess:
      summary: Multi-file upload result
      value:
        success: true
        data:
          uploads:
            - id: cm2x1y2z3
              publicId: lumi/products/board-001
              url: https://res.cloudinary.com/lumi/image/upload/v1727704823/lumi/products/board-001.jpg
              secureUrl: https://res.cloudinary.com/lumi/image/upload/v1727704823/lumi/products/board-001.jpg
              folder: lumi/products
              format: jpg
              resourceType: image
              type: upload
              width: 1920
              height: 1080
              bytes: 245678
              tags:
                - product:cm2a0b1c2
                - hero
              version: 3
              visibility: public
              transformations:
                thumbnail: https://res.cloudinary.com/lumi/image/upload/c_fill,w_300,h_300/v1727704823/lumi/products/board-001.jpg
                medium: https://res.cloudinary.com/lumi/image/upload/c_limit,w_800/v1727704823/lumi/products/board-001.jpg
                large: https://res.cloudinary.com/lumi/image/upload/c_limit,w_1920/v1727704823/lumi/products/board-001.jpg
                responsive_640: https://res.cloudinary.com/lumi/image/upload/c_limit,w_640/v1727704823/lumi/products/board-001.jpg
              metadata:
                alt: Carbon desk with walnut legs
                dominantColor: "#3B82F6"
          failures: []
        meta:
          counts:
            total: 1
            uploaded: 1
            failed: 0
          partialFailure: false
    MediaUploadPayloadTooLarge:
      summary: Upload rejected due to size
      value:
        success: false
        error:
          code: PAYLOAD_TOO_LARGE
          message: File exceeds maximum allowed size.
          details:
            - message: Maximum allowed size is 5242880 bytes
              fileName: hero.png
        meta:
          timestamp: 2025-10-01T12:00:00Z
          requestId: d2fa64a9-fd79-4c6d-925c-9b5a83185cf8
    MediaDeleteForbidden:
      summary: Delete denied
      value:
        success: false
        error:
          code: FORBIDDEN
          message: Administrator privileges required to delete media assets.
        meta:
          timestamp: 2025-10-01T12:00:00Z
          requestId: e6b60c86-0aac-4f56-aa55-0fb52e8c4760
    MediaUploadUnsupportedMime:
      summary: Unsupported MIME type
      value:
        success: false
        error:
          code: UNSUPPORTED_MEDIA_TYPE
          message: Unsupported media type.
          details:
            - message: MIME type application/x-msdownload is not supported.
              fileName: payload.exe
        meta:
          timestamp: 2025-10-01T12:00:00Z
          requestId: 918eb7a5-1d57-48df-94c1-b415cbc6ebb0
    MediaAssetSuccess:
      summary: Single media asset
      value:
        success: true
        data:
          id: cm2x1y2z3
          publicId: lumi/products/board-001
          url: https://res.cloudinary.com/lumi/image/upload/v1727704823/lumi/products/board-001.jpg
          secureUrl: https://res.cloudinary.com/lumi/image/upload/v1727704823/lumi/products/board-001.jpg
          folder: lumi/products
          format: jpg
          resourceType: image
          type: upload
          width: 1920
          height: 1080
          bytes: 245678
          tags:
            - product:cm2a0b1c2
            - hero
          metadata:
            alt: Carbon desk with walnut legs
            dominantColor: "#3B82F6"
          version: 3
          visibility: public
          transformations:
            thumbnail: https://res.cloudinary.com/lumi/image/upload/c_fill,w_300,h_300/v1727704823/lumi/products/board-001.jpg
            medium: https://res.cloudinary.com/lumi/image/upload/c_limit,w_800/v1727704823/lumi/products/board-001.jpg
            large: https://res.cloudinary.com/lumi/image/upload/c_limit,w_1920/v1727704823/lumi/products/board-001.jpg
            responsive_640: https://res.cloudinary.com/lumi/image/upload/c_limit,w_640/v1727704823/lumi/products/board-001.jpg
          usage:
            products:
              - id: cm2a0b1c2
                title: Carbon Desk
                slug: carbon-desk
            variants:
              - id: cm2a0b1v0
                sku: CARBON-DESK-STD
                productId: cm2a0b1c2
          createdAt: 2025-09-29T10:01:08.000Z
          updatedAt: 2025-09-29T10:01:08.000Z
    MediaDeleteConflict:
      summary: Media asset still referenced
      value:
        success: false
        error:
          code: CONFLICT
          message: Media asset is currently assigned to products or variants.
          details:
            - message: Detach all associations before deleting this asset.
              products: 2
              variants: 1
        meta:
          timestamp: 2025-10-01T12:00:00Z
          requestId: 8fd53f56-2c1d-4d6c-9b9b-4b1f683d8fe4
  responses:
    UnauthorizedError:
      description: Caller is not authenticated.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/StandardErrorResponse"
          examples:
            default:
              value:
                success: false
                error:
                  code: UNAUTHORIZED
                  message: Authentication token missing or expired.
                meta:
                  timestamp: 2025-10-01T12:00:00Z
                  requestId: 3b379a4b-7ab4-48b0-9eae-2ca8c59dbb53
    ForbiddenError:
      description: Caller lacks sufficient privileges (RBAC failure).
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/StandardErrorResponse"
          examples:
            default:
              value:
                success: false
                error:
                  code: FORBIDDEN
                  message: Administrator privileges required.
                meta:
                  timestamp: 2025-10-01T12:00:00Z
                  requestId: f631c7be-e876-4d6b-9b9f-4de9128010a9
  schemas:
    Meta:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        requestId:
          type: string
          format: uuid
        pagination:
          $ref: "#/components/schemas/Pagination"
    Pagination:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
        perPage:
          type: integer
          minimum: 1
          maximum: 200
        total:
          type: integer
          minimum: 0
        totalPages:
          type: integer
          minimum: 0
    StandardSuccessResponse:
      type: object
      required:
        - success
        - data
      properties:
        success:
          type: boolean
          enum:
            - true
          description: Indicates the request completed successfully.
        data:
          description: Response payload specific to the request.
        meta:
          type: object
          additionalProperties: true
          description: Optional metadata contextualising the response.
    StandardError:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Stable machine-readable error code.
          examples:
            - FORBIDDEN
            - UNAUTHORIZED
        message:
          type: string
          description: Human readable summary of the error.
          examples:
            - Administrator privileges required.
        details:
          $ref: "#/components/schemas/ErrorDetails"
    StandardErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          enum:
            - false
          description: Indicates the request failed.
        error:
          $ref: "#/components/schemas/StandardError"
        meta:
          type: object
          additionalProperties: true
          description: Optional metadata contextualising the error.
    Money:
      type: object
      required:
        - amount
        - currency
      properties:
        amount:
          type: string
          pattern: ^-?\d+(?:\.\d{1,2})?$
          description: Decimal amount represented as a string with up to two fractional digits.
          examples:
            - "199.99"
            - "0.00"
        currency:
          type: string
          minLength: 3
          maxLength: 3
          pattern: ^[A-Z]{3}$
          description: ISO-4217 currency code.
          examples:
            - TRY
            - USD
    AuditTimestamps:
      type: object
      required:
        - createdAt
        - updatedAt
      properties:
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp in ISO-8601 format.
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp in ISO-8601 format.
    SoftDelete:
      type: object
      properties:
        deletedAt:
          type: string
          format: date-time
          nullable: true
    Category:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - name
            - slug
          properties:
            id:
              type: string
              format: cuid
            name:
              type: string
            slug:
              type: string
            description:
              type: string
              nullable: true
            parentId:
              type: string
              format: cuid
              nullable: true
            path:
              type: string
            level:
              type: integer
            imageUrl:
              type: string
              format: uri
              nullable: true
            displayOrder:
              type: integer
              nullable: true
    ProductVariant:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - title
            - price
            - stock
            - isPrimary
          properties:
            id:
              type: string
              format: cuid
            title:
              type: string
            sku:
              type: string
              nullable: true
            price:
              $ref: "#/components/schemas/Money"
            compareAtPrice:
              $ref: "#/components/schemas/Money"
              nullable: true
            stock:
              type: integer
              minimum: 0
            attributes:
              type: object
              nullable: true
              additionalProperties: true
            weightGrams:
              type: integer
              nullable: true
            isPrimary:
              type: boolean
    MediaUsageSummary:
      type: object
      required:
        - products
        - variants
      properties:
        products:
          type: array
          items:
            type: object
            required:
              - id
              - title
              - slug
            properties:
              id:
                type: string
                format: cuid
              title:
                type: string
              slug:
                type: string
        variants:
          type: array
          items:
            type: object
            required:
              - id
              - productId
            properties:
              id:
                type: string
                format: cuid
              productId:
                type: string
                format: cuid
              sku:
                type: string
                nullable: true
    MediaAsset:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - assetId
            - url
            - type
            - provider
            - mimeType
            - sizeBytes
            - visibility
          properties:
            id:
              type: string
              format: cuid
            assetId:
              type: string
              maxLength: 120
            url:
              type: string
              format: uri
            type:
              type: string
              enum:
                - IMAGE
                - VIDEO
                - DOCUMENT
            provider:
              type: string
              enum:
                - CLOUDINARY
                - S3
            visibility:
              type: string
              enum:
                - PUBLIC
                - PRIVATE
                - INTERNAL
            mimeType:
              type: string
            sizeBytes:
              type: integer
              minimum: 0
            width:
              type: integer
              nullable: true
            height:
              type: integer
              nullable: true
            alt:
              type: string
              nullable: true
            caption:
              type: string
              nullable: true
    MediaUploadFailure:
      type: object
      required:
        - fileName
        - message
        - code
      properties:
        fileName:
          type: string
        message:
          type: string
        code:
          type: string
        status:
          type: integer
          minimum: 100
          maximum: 599
          nullable: true
    MediaUploadResult:
      type: object
      required:
        - uploads
        - failures
      properties:
        uploads:
          type: array
          description: Successfully persisted media assets.
          items:
            $ref: "#/components/schemas/MediaAsset"
        failures:
          type: array
          description: Uploads rejected due to validation or threat scanning.
          items:
            $ref: "#/components/schemas/MediaUploadFailure"
    MediaUploadMeta:
      type: object
      required:
        - counts
        - partialFailure
      properties:
        counts:
          type: object
          required:
            - total
            - uploaded
            - failed
          properties:
            total:
              type: integer
              minimum: 0
            uploaded:
              type: integer
              minimum: 0
            failed:
              type: integer
              minimum: 0
        partialFailure:
          type: boolean
    Product:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - $ref: "#/components/schemas/SoftDelete"
        - type: object
          required:
            - id
            - title
            - slug
            - status
            - price
            - inventoryPolicy
          properties:
            id:
              type: string
              format: cuid
            title:
              type: string
            slug:
              type: string
            status:
              type: string
              enum:
                - DRAFT
                - ACTIVE
                - ARCHIVED
            summary:
              type: string
              nullable: true
            description:
              type: string
              nullable: true
            price:
              $ref: "#/components/schemas/Money"
            compareAtPrice:
              $ref: "#/components/schemas/Money"
            inventoryPolicy:
              type: string
              enum:
                - TRACK
                - CONTINUE
                - DENY
            currency:
              type: string
            variants:
              type: array
              items:
                $ref: "#/components/schemas/ProductVariant"
            categories:
              type: array
              items:
                $ref: "#/components/schemas/Category"
            media:
              type: array
              items:
                $ref: "#/components/schemas/MediaAsset"
            attributes:
              type: object
              additionalProperties: true
              nullable: true
    CartItem:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - cartId
            - productVariantId
            - quantity
            - unitPrice
          properties:
            id:
              type: string
              format: cuid
            cartId:
              type: string
              format: cuid
            productVariantId:
              type: string
              format: cuid
            quantity:
              type: integer
              minimum: 1
            unitPrice:
              $ref: "#/components/schemas/Money"
            productVariant:
              $ref: "#/components/schemas/ProductVariant"
              nullable: true
    CartTotals:
      type: object
      required:
        - subtotal
        - tax
        - discount
        - total
      properties:
        subtotal:
          $ref: "#/components/schemas/Money"
        tax:
          $ref: "#/components/schemas/Money"
        discount:
          $ref: "#/components/schemas/Money"
        total:
          $ref: "#/components/schemas/Money"
    Cart:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - status
            - items
            - totals
          properties:
            id:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
              nullable: true
            sessionId:
              type: string
              nullable: true
            status:
              type: string
              enum:
                - ACTIVE
                - CHECKED_OUT
                - ABANDONED
            expiresAt:
              type: string
              format: date-time
              nullable: true
            items:
              type: array
              items:
                $ref: "#/components/schemas/CartItem"
            totals:
              $ref: "#/components/schemas/CartTotals"
    Address:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - fullName
            - line1
            - city
            - country
          properties:
            id:
              type: string
              format: cuid
            label:
              type: string
            fullName:
              type: string
            phone:
              type: string
              nullable: true
            line1:
              type: string
            line2:
              type: string
              nullable: true
            city:
              type: string
            state:
              type: string
              nullable: true
            postalCode:
              type: string
            country:
              type: string
            isDefault:
              type: boolean
    OrderItem:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - orderId
            - productId
            - productVariantId
            - quantity
            - unitPrice
          properties:
            id:
              type: string
              format: cuid
            orderId:
              type: string
              format: cuid
            productId:
              type: string
              format: cuid
            productVariantId:
              type: string
              format: cuid
            quantity:
              type: integer
              minimum: 1
            unitPrice:
              $ref: "#/components/schemas/Money"
            currency:
              type: string
              minLength: 3
              maxLength: 3
              pattern: ^[A-Z]{3}$
            titleSnapshot:
              type: string
            variantSnapshot:
              type: object
              additionalProperties: true
              nullable: true
    Order:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - reference
            - status
            - totalAmount
          properties:
            id:
              type: string
              format: cuid
            reference:
              type: string
            status:
              type: string
              enum:
                - PENDING
                - PAID
                - FULFILLED
                - SHIPPED
                - DELIVERED
                - CANCELLED
            totalAmount:
              $ref: "#/components/schemas/Money"
            subtotalAmount:
              $ref: "#/components/schemas/Money"
            taxAmount:
              $ref: "#/components/schemas/Money"
            discountAmount:
              $ref: "#/components/schemas/Money"
            currency:
              type: string
            items:
              type: array
              items:
                $ref: "#/components/schemas/OrderItem"
            itemsCount:
              type: integer
            shippingAddressId:
              type: string
              nullable: true
            billingAddressId:
              type: string
              nullable: true
    OrderDetail:
      allOf:
        - $ref: "#/components/schemas/Order"
        - type: object
          properties:
            shippingAddress:
              $ref: "#/components/schemas/Address"
            billingAddress:
              $ref: "#/components/schemas/Address"
            payments:
              type: array
              items:
                $ref: "#/components/schemas/Payment"
            timeline:
              type: array
              items:
                $ref: "#/components/schemas/OrderStatusEvent"
            tracking:
              $ref: "#/components/schemas/Tracking"
    Payment:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - provider
            - status
            - amount
          properties:
            id:
              type: string
              format: cuid
            provider:
              type: string
              enum:
                - IYZICO
                - STRIPE
                - PAYPAL
                - MANUAL
            status:
              type: string
              enum:
                - INITIATED
                - AUTHORIZED
                - SETTLED
                - FAILED
                - REFUNDED
            transactionId:
              type: string
            amount:
              $ref: "#/components/schemas/Money"
            currency:
              type: string
            failureReason:
              type: string
              nullable: true
    OrderStatusEvent:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum:
            - PENDING
            - PAID
            - FULFILLED
            - SHIPPED
            - DELIVERED
            - CANCELLED
        timestamp:
          type: string
          format: date-time
    Tracking:
      type: object
      properties:
        trackingNumber:
          type: string
          nullable: true
        trackingUrl:
          type: string
          format: uri
          nullable: true
        carrier:
          type: string
          nullable: true
        estimatedDelivery:
          type: string
          format: date-time
          nullable: true
    UserProfile:
      type: object
      required:
        - user
        - addresses
        - preferences
      properties:
        user:
          $ref: "#/components/schemas/User"
        addresses:
          type: array
          items:
            $ref: "#/components/schemas/Address"
        preferences:
          $ref: "#/components/schemas/UserPreferences"
    User:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - email
            - status
          properties:
            id:
              type: string
              format: cuid
            email:
              type: string
              format: email
            firstName:
              type: string
              nullable: true
            lastName:
              type: string
              nullable: true
            status:
              type: string
              enum:
                - ACTIVE
                - SUSPENDED
                - DELETED
            roles:
              type: array
              items:
                type: string
            permissions:
              type: array
              items:
                type: string
            emailVerified:
              type: boolean
    UserPreferences:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - language
            - currency
            - marketingOptIn
            - notifications
          properties:
            language:
              type: string
            currency:
              type: string
            marketingOptIn:
              type: boolean
            notifications:
              type: object
              properties:
                email:
                  type: boolean
                sms:
                  type: boolean
                push:
                  type: boolean
            privacy:
              type: object
              properties:
                personalisedRecommendations:
                  type: boolean
                dataSharing:
                  type: boolean
                profileVisibility:
                  type: string
                  enum:
                    - private
                    - customers
                    - public
    ProductCreateInput:
      type: object
      required:
        - title
        - price
        - variants
        - categoryIds
      properties:
        title:
          type: string
        slug:
          type: string
        summary:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        status:
          type: string
        price:
          $ref: "#/components/schemas/Money"
        compareAtPrice:
          $ref: "#/components/schemas/Money"
        currency:
          type: string
        inventoryPolicy:
          type: string
        searchKeywords:
          type: array
          items:
            type: string
        variants:
          type: array
          items:
            type: object
            required:
              - title
              - price
            properties:
              title:
                type: string
              sku:
                type: string
              price:
                $ref: "#/components/schemas/Money"
              stock:
                type: integer
                minimum: 0
              isPrimary:
                type: boolean
        categoryIds:
          type: array
          items:
            type: string
            format: cuid
        media:
          type: array
          items:
            type: object
            properties:
              mediaId:
                type: string
                format: cuid
              sortOrder:
                type: integer
                nullable: true
              isPrimary:
                type: boolean
    ProductUpdateInput:
      allOf:
        - $ref: "#/components/schemas/ProductCreateInput"
      description: |
        Partial update payload; unspecified fields remain unchanged.
    CategoryInput:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        slug:
          type: string
        description:
          type: string
          nullable: true
        parentId:
          type: string
          format: cuid
        imageUrl:
          type: string
          format: uri
        displayOrder:
          type: integer
          nullable: true
    CartItemInput:
      type: object
      required:
        - productVariantId
        - quantity
      properties:
        productVariantId:
          type: string
          format: cuid
        quantity:
          type: integer
          minimum: 1
          maximum: 20
    CartMergeInput:
      type: object
      required:
        - guestCartId
      properties:
        guestCartId:
          type: string
          format: cuid
        overrideStrategy:
          type: string
          enum:
            - MERGE
            - REPLACE
          default: MERGE
    OrderCreateInput:
      type: object
      properties:
        cartId:
          type: string
          format: cuid
        shippingAddressId:
          type: string
          format: cuid
        billingAddressId:
          type: string
          format: cuid
        couponCode:
          type: string
        notes:
          type: string
          nullable: true
    OrderStatusUpdateInput:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - PENDING
            - PAID
            - FULFILLED
            - SHIPPED
            - DELIVERED
            - CANCELLED
        reason:
          type: string
          nullable: true
    OrderNoteInput:
      type: object
      required:
        - note
      properties:
        note:
          type: string
    RefundRequestInput:
      type: object
      required:
        - amount
        - reason
      properties:
        amount:
          $ref: "#/components/schemas/Money"
        reason:
          type: string
    UserProfileUpdateInput:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
    ChangePasswordInput:
      type: object
      required:
        - currentPassword
        - newPassword
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
          minLength: 12
    AddressInput:
      type: object
      required:
        - label
        - fullName
        - line1
        - city
        - country
        - postalCode
      properties:
        label:
          type: string
        fullName:
          type: string
        phone:
          type: string
        line1:
          type: string
        line2:
          type: string
          nullable: true
        city:
          type: string
        state:
          type: string
        postalCode:
          type: string
        country:
          type: string
        isDefault:
          type: boolean
    UserPreferencesInput:
      type: object
      properties:
        language:
          type: string
        currency:
          type: string
        marketingOptIn:
          type: boolean
        notifications:
          type: object
          properties:
            email:
              type: boolean
            sms:
              type: boolean
            push:
              type: boolean
        privacy:
          type: object
          properties:
            personalisedRecommendations:
              type: boolean
            dataSharing:
              type: boolean
            profileVisibility:
              type: string
              enum:
                - private
                - customers
                - public
    CartValidationIssue:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        itemId:
          type: string
          format: cuid
          nullable: true
    CartValidationResult:
      type: object
      required:
        - cart
        - issues
      properties:
        cart:
          $ref: "#/components/schemas/Cart"
        issues:
          type: array
          items:
            $ref: "#/components/schemas/CartValidationIssue"
    OrderStats:
      type: object
      properties:
        totalOrders:
          type: integer
        revenue:
          $ref: "#/components/schemas/Money"
        pending:
          type: integer
        paid:
          type: integer
        cancelled:
          type: integer
        fulfillmentLatencyP95:
          type: integer
          description: Milliseconds between placement and fulfillment.
    UserStatusUpdateInput:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - ACTIVE
            - SUSPENDED
            - DELETED
    AdminUnlockUserInput:
      type: object
      properties:
        reason:
          type: string
          nullable: true
    ErrorDetails:
      type: object
      additionalProperties: true
      description: Additional information to help diagnose the failure.
    AuthUserProfile:
      type: object
      description: Canonical representation of an authenticated user.
      required:
        - id
        - email
        - emailVerified
        - status
        - roles
        - permissions
      properties:
        id:
          type: string
          format: uuid
          description: Stable user identifier.
        email:
          type: string
          format: email
          description: Normalised email address.
        firstName:
          type: string
          nullable: true
          description: Optional given name.
        lastName:
          type: string
          nullable: true
          description: Optional family name.
        phone:
          type: string
          nullable: true
          description: Optional E.164 formatted phone number.
        emailVerified:
          type: boolean
          description: Indicates whether the email address has been confirmed.
        status:
          type: string
          description: Account lifecycle state.
          enum:
            - ACTIVE
            - SUSPENDED
            - DELETED
        roles:
          type: array
          description: Role slugs assigned to the user.
          items:
            type: string
        permissions:
          type: array
          description: Permission keys granted to the user.
          items:
            type: string
    AuthTokenEnvelope:
      type: object
      description: Signed JWT payload metadata.
      required:
        - token
        - expiresAt
      properties:
        token:
          type: string
          description: Signed JWT token value.
        expiresAt:
          type: string
          format: date-time
          description: Token expiry in UTC.
    AuthTokenPair:
      type: object
      description: Access and refresh token bundle.
      required:
        - accessToken
        - refreshToken
      properties:
        accessToken:
          $ref: "#/components/schemas/AuthTokenEnvelope"
        refreshToken:
          $ref: "#/components/schemas/AuthTokenEnvelope"
    AuthRegisterResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: object
              required:
                - user
                - emailVerification
              properties:
                user:
                  $ref: "#/components/schemas/AuthUserProfile"
                emailVerification:
                  type: object
                  required:
                    - expiresAt
                  properties:
                    expiresAt:
                      type: string
                      format: date-time
                      description: Expiry timestamp for the verification token.
    AuthLoginResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: object
              required:
                - sessionId
                - accessToken
                - refreshToken
                - accessTokenExpiresAt
                - refreshTokenExpiresAt
                - user
              properties:
                sessionId:
                  type: string
                  format: uuid
                  description: Active session identifier.
                accessToken:
                  type: string
                  description: Signed access token for authorising API calls.
                refreshToken:
                  type: string
                  description: Signed refresh token issued alongside the cookie.
                accessTokenExpiresAt:
                  type: string
                  format: date-time
                  description: Expiry for the access token.
                refreshTokenExpiresAt:
                  type: string
                  format: date-time
                  description: Expiry for the refresh token.
                user:
                  $ref: "#/components/schemas/AuthUserProfile"
    AuthRefreshResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: object
              required:
                - sessionId
                - accessToken
                - refreshToken
                - accessTokenExpiresAt
                - refreshTokenExpiresAt
                - user
              properties:
                sessionId:
                  type: string
                  format: uuid
                accessToken:
                  type: string
                refreshToken:
                  type: string
                accessTokenExpiresAt:
                  type: string
                  format: date-time
                refreshTokenExpiresAt:
                  type: string
                  format: date-time
                user:
                  $ref: "#/components/schemas/AuthUserProfile"
    AuthLogoutResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: object
              required:
                - sessionId
              properties:
                sessionId:
                  type: string
                  format: uuid
                  description: Identifier of the revoked session.
    AuthLogoutAllResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: object
              required:
                - revokedSessions
              properties:
                revokedSessions:
                  type: integer
                  minimum: 0
                  description: Number of sessions revoked during the operation.
    AuthUserResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: object
              required:
                - user
              properties:
                user:
                  $ref: "#/components/schemas/AuthUserProfile"
    AuthMessageResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  description: Informational message for the caller.
    RegisterRequest:
      type: object
      required:
        - email
        - password
        - firstName
        - lastName
      properties:
        email:
          type: string
          format: email
          description: Unique email address for the account.
        password:
          type: string
          minLength: 12
          description: Must satisfy the platform password policy (minimum 12 characters, upper and lower case, number, special
            character).
        firstName:
          type: string
          minLength: 2
          maxLength: 100
        lastName:
          type: string
          minLength: 2
          maxLength: 100
        phone:
          type: string
          nullable: true
          description: Optional phone number in international format.
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 1
          maxLength: 256
    VerifyEmailRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          minLength: 10
          description: Signed verification token received via email.
    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
    ResetPasswordRequest:
      type: object
      required:
        - token
        - password
      properties:
        token:
          type: string
          minLength: 10
          description: Password reset token received via email.
        password:
          type: string
          minLength: 12
          description: New password satisfying the platform policy.
    ChangePasswordRequest:
      type: object
      required:
        - currentPassword
        - newPassword
      properties:
        currentPassword:
          type: string
          minLength: 1
          maxLength: 256
          description: Current password for verification.
        newPassword:
          type: string
          minLength: 12
          description: Replacement password that must satisfy the platform policy and differ from the current password.
    HealthComponent:
      type: object
      required:
        - status
        - summary
        - observedAt
      properties:
        status:
          type: string
          enum:
            - healthy
            - degraded
            - unhealthy
          description: Component health status derived from the latest probe.
        summary:
          type: string
          description: High level description of the component state.
        details:
          type: object
          additionalProperties: true
          description: Detailed diagnostic data supplied by the component probe.
        severity:
          type: string
          enum:
            - info
            - warn
            - error
            - fatal
          description: Recommended alerting severity for the reported state.
        observedAt:
          type: string
          format: date-time
          description: UTC timestamp when the component was evaluated.
    HealthSnapshot:
      type: object
      required:
        - status
        - uptimeSeconds
        - timestamp
        - components
      properties:
        status:
          type: string
          enum:
            - healthy
            - degraded
            - unhealthy
          description: Overall system health derived from the individual component states.
        uptimeSeconds:
          type: number
          format: double
          description: Node.js process uptime at the time of the snapshot.
        responseTimeMs:
          type: number
          format: double
          description: Time taken to evaluate all health checks, in milliseconds.
        timestamp:
          type: string
          format: date-time
          description: UTC timestamp when the snapshot was generated.
        components:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/HealthComponent"
          description: Collection of component health summaries keyed by identifier.
        metrics:
          type: object
          properties:
            memory:
              type: object
              additionalProperties:
                type: number
                format: double
              description: Per-segment memory usage in bytes.
            cpu:
              type: object
              properties:
                userMs:
                  type: number
                  format: double
                systemMs:
                  type: number
                  format: double
            load:
              type: object
              properties:
                averages:
                  type: array
                  items:
                    type: number
                    format: double
                  minItems: 3
                  maxItems: 3
                  description: 1, 5, and 15 minute load averages.
    HealthResponseMeta:
      type: object
      properties:
        environment:
          type: string
        service:
          type: string
        check:
          type: string
          description: Identifier for the health check variant.
        generatedAt:
          type: string
          format: date-time
          description: Timestamp representing when the metadata snapshot was captured.
    HealthComprehensiveResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/HealthSnapshot"
            meta:
              allOf:
                - $ref: "#/components/schemas/HealthResponseMeta"
                - type: object
                  properties:
                    check:
                      type: string
                      enum:
                        - comprehensive
    HealthReadinessData:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum:
            - healthy
            - degraded
            - unhealthy
        timestamp:
          type: string
          format: date-time
    HealthReadinessResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/HealthReadinessData"
            meta:
              allOf:
                - $ref: "#/components/schemas/HealthResponseMeta"
                - type: object
                  properties:
                    check:
                      type: string
                      enum:
                        - readiness
    HealthLivenessData:
      type: object
      required:
        - status
        - uptimeSeconds
        - timestamp
      properties:
        status:
          type: string
          enum:
            - healthy
        uptimeSeconds:
          type: number
          format: double
        timestamp:
          type: string
          format: date-time
    HealthLivenessResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/HealthLivenessData"
            meta:
              allOf:
                - $ref: "#/components/schemas/HealthResponseMeta"
                - type: object
                  properties:
                    check:
                      type: string
                      enum:
                        - liveness
    SoftDeleteMetadata:
      type: object
      properties:
        deletedAt:
          type: string
          format: date-time
          nullable: true
          description: Timestamp indicating when the record was soft deleted.
    UserRoleSummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - name
          properties:
            id:
              type: string
              format: cuid
            name:
              type: string
              maxLength: 120
            description:
              type: string
              nullable: true
    UserPermissionSummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - key
          properties:
            id:
              type: string
              format: cuid
            key:
              type: string
              maxLength: 120
            description:
              type: string
              nullable: true
    UserSummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - email
            - status
            - emailVerified
            - roles
            - permissions
          properties:
            id:
              type: string
              format: cuid
            email:
              type: string
              format: email
            firstName:
              type: string
              nullable: true
            lastName:
              type: string
              nullable: true
            fullName:
              type: string
              nullable: true
            phone:
              type: string
              nullable: true
            status:
              type: string
              enum:
                - ACTIVE
                - SUSPENDED
                - DELETED
            emailVerified:
              type: boolean
            roles:
              type: array
              items:
                $ref: "#/components/schemas/UserRoleSummary"
            permissions:
              type: array
              items:
                $ref: "#/components/schemas/UserPermissionSummary"
    CategorySummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - name
            - slug
            - path
            - level
          properties:
            id:
              type: string
              format: cuid
            name:
              type: string
            slug:
              type: string
              pattern: ^[a-z0-9]+(?:-[a-z0-9]+)*$
            description:
              type: string
              nullable: true
            parentId:
              type: string
              format: cuid
              nullable: true
            level:
              type: integer
              minimum: 0
            path:
              type: string
            imageUrl:
              type: string
              format: uri
              nullable: true
            iconUrl:
              type: string
              format: uri
              nullable: true
            displayOrder:
              type: integer
              nullable: true
    ProductMedia:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - productId
            - mediaId
            - isPrimary
            - media
          properties:
            productId:
              type: string
              format: cuid
            mediaId:
              type: string
              format: cuid
            sortOrder:
              type: integer
              nullable: true
            isPrimary:
              type: boolean
            media:
              $ref: "#/components/schemas/MediaAsset"
    ProductSummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - $ref: "#/components/schemas/SoftDeleteMetadata"
        - type: object
          required:
            - id
            - title
            - slug
            - status
            - price
            - currency
            - inventoryPolicy
            - variants
            - categories
            - media
          properties:
            id:
              type: string
              format: cuid
            title:
              type: string
            slug:
              type: string
              pattern: ^[a-z0-9]+(?:-[a-z0-9]+)*$
            sku:
              type: string
              nullable: true
            summary:
              type: string
              nullable: true
            description:
              type: string
              nullable: true
            status:
              type: string
              enum:
                - DRAFT
                - ACTIVE
                - ARCHIVED
            price:
              $ref: "#/components/schemas/Money"
            compareAtPrice:
              $ref: "#/components/schemas/Money"
              nullable: true
            currency:
              type: string
              minLength: 3
              maxLength: 3
              pattern: ^[A-Z]{3}$
            inventoryPolicy:
              type: string
              enum:
                - TRACK
                - CONTINUE
                - DENY
            searchKeywords:
              type: array
              items:
                type: string
            attributes:
              type: object
              additionalProperties: true
              nullable: true
            variants:
              type: array
              items:
                $ref: "#/components/schemas/ProductVariant"
            categories:
              type: array
              items:
                $ref: "#/components/schemas/CategorySummary"
            media:
              type: array
              items:
                $ref: "#/components/schemas/ProductMedia"
    ProductCollectionResponse:
      allOf:
        - $ref: "#/components/schemas/StandardSuccessResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/ProductSummary"
            meta:
              $ref: "#/components/schemas/PaginationMeta"
    CartSummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - status
            - items
            - totals
          properties:
            id:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
              nullable: true
            sessionId:
              type: string
              nullable: true
            status:
              type: string
              enum:
                - ACTIVE
                - CHECKED_OUT
                - ABANDONED
            expiresAt:
              type: string
              format: date-time
              nullable: true
            items:
              type: array
              items:
                $ref: "#/components/schemas/CartItem"
            totals:
              $ref: "#/components/schemas/CartTotals"
    OrderSummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - reference
            - status
            - totalAmount
            - subtotalAmount
            - taxAmount
            - discountAmount
            - currency
            - items
            - itemsCount
          properties:
            id:
              type: string
              format: cuid
            reference:
              type: string
            userId:
              type: string
              format: cuid
              nullable: true
            cartId:
              type: string
              format: cuid
              nullable: true
            status:
              type: string
              enum:
                - PENDING
                - PAID
                - FULFILLED
                - SHIPPED
                - DELIVERED
                - CANCELLED
            totalAmount:
              $ref: "#/components/schemas/Money"
            subtotalAmount:
              $ref: "#/components/schemas/Money"
            taxAmount:
              $ref: "#/components/schemas/Money"
            discountAmount:
              $ref: "#/components/schemas/Money"
            currency:
              type: string
              minLength: 3
              maxLength: 3
              pattern: ^[A-Z]{3}$
            placedAt:
              type: string
              format: date-time
              nullable: true
            fulfilledAt:
              type: string
              format: date-time
              nullable: true
            shippedAt:
              type: string
              format: date-time
              nullable: true
            deliveredAt:
              type: string
              format: date-time
              nullable: true
            cancelledAt:
              type: string
              format: date-time
              nullable: true
            notes:
              type: string
              nullable: true
            metadata:
              type: object
              additionalProperties: true
              nullable: true
            items:
              type: array
              items:
                $ref: "#/components/schemas/OrderItem"
            itemsCount:
              type: integer
              minimum: 0
            shippingAddressId:
              type: string
              format: cuid
              nullable: true
            billingAddressId:
              type: string
              format: cuid
              nullable: true
    PaymentSummary:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - orderId
            - provider
            - status
            - transactionId
            - amount
            - currency
          properties:
            id:
              type: string
              format: cuid
            orderId:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
              nullable: true
            provider:
              type: string
              enum:
                - IYZICO
                - STRIPE
                - PAYPAL
                - MANUAL
            status:
              type: string
              enum:
                - INITIATED
                - AUTHORIZED
                - SETTLED
                - FAILED
                - REFUNDED
            transactionId:
              type: string
            conversationId:
              type: string
              nullable: true
            amount:
              $ref: "#/components/schemas/Money"
            paidPrice:
              $ref: "#/components/schemas/Money"
              nullable: true
            currency:
              type: string
              minLength: 3
              maxLength: 3
              pattern: ^[A-Z]{3}$
            installment:
              type: integer
              nullable: true
            paymentChannel:
              type: string
              nullable: true
            paymentGroup:
              type: string
              nullable: true
            cardToken:
              type: string
              nullable: true
            cardAssociation:
              type: string
              nullable: true
            cardFamily:
              type: string
              nullable: true
            cardType:
              type: string
              nullable: true
            cardBankName:
              type: string
              nullable: true
            cardHolderName:
              type: string
              nullable: true
            binNumber:
              type: string
              nullable: true
            lastFourDigits:
              type: string
              nullable: true
            ipAddress:
              type: string
              nullable: true
            deviceId:
              type: string
              nullable: true
            fraudScore:
              type: number
              nullable: true
            riskFlags:
              type: object
              additionalProperties: true
              nullable: true
            authorizedAt:
              type: string
              format: date-time
              nullable: true
            settledAt:
              type: string
              format: date-time
              nullable: true
            failedAt:
              type: string
              format: date-time
              nullable: true
            failureReason:
              type: string
              nullable: true
            failureCode:
              type: string
              nullable: true
            rawPayload:
              type: object
              additionalProperties: true
              nullable: true
    PaymentRefundRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - paymentId
            - amount
            - currency
            - status
          properties:
            id:
              type: string
              format: cuid
            paymentId:
              type: string
              format: cuid
            amount:
              $ref: "#/components/schemas/Money"
            currency:
              type: string
              minLength: 3
              maxLength: 3
              pattern: ^[A-Z]{3}$
            reason:
              type: string
              nullable: true
            status:
              type: string
            refundId:
              type: string
              nullable: true
            processedAt:
              type: string
              format: date-time
              nullable: true
            failureReason:
              type: string
              nullable: true
            failureCode:
              type: string
              nullable: true
            metadata:
              type: object
              additionalProperties: true
              nullable: true
    InventoryRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - productVariantId
            - quantityAvailable
            - quantityReserved
            - quantityOnHand
          properties:
            id:
              type: string
              format: cuid
            productVariantId:
              type: string
              format: cuid
            quantityAvailable:
              type: integer
              minimum: 0
            quantityReserved:
              type: integer
              minimum: 0
            quantityOnHand:
              type: integer
              minimum: 0
            lowStockThreshold:
              type: integer
              nullable: true
    AddressRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - userId
            - label
            - fullName
            - line1
            - city
            - postalCode
            - country
          properties:
            id:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
            label:
              type: string
            fullName:
              type: string
            phone:
              type: string
              nullable: true
            line1:
              type: string
            line2:
              type: string
              nullable: true
            city:
              type: string
            state:
              type: string
              nullable: true
            postalCode:
              type: string
            country:
              type: string
            isDefault:
              type: boolean
    SavedCardRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - userId
            - cardToken
            - lastFourDigits
            - expiryMonth
            - expiryYear
          properties:
            id:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
            cardToken:
              type: string
            cardAlias:
              type: string
              nullable: true
            binNumber:
              type: string
              nullable: true
            lastFourDigits:
              type: string
            cardType:
              type: string
              nullable: true
            cardAssociation:
              type: string
              nullable: true
            cardFamily:
              type: string
              nullable: true
            cardBankName:
              type: string
              nullable: true
            cardHolderName:
              type: string
              nullable: true
            expiryMonth:
              type: integer
              minimum: 1
              maximum: 12
            expiryYear:
              type: integer
            isDefault:
              type: boolean
    ReviewRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - productId
            - userId
            - rating
            - title
            - status
          properties:
            id:
              type: string
              format: cuid
            productId:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
            orderId:
              type: string
              format: cuid
              nullable: true
            rating:
              type: integer
              minimum: 1
              maximum: 5
            title:
              type: string
            content:
              type: string
              nullable: true
            isVerifiedPurchase:
              type: boolean
            status:
              type: string
              enum:
                - PENDING
                - APPROVED
                - REJECTED
            helpfulCount:
              type: integer
              minimum: 0
            notHelpfulCount:
              type: integer
              minimum: 0
    ReviewMediaRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - reviewId
            - mediaId
          properties:
            reviewId:
              type: string
              format: cuid
            mediaId:
              type: string
              format: cuid
            sortOrder:
              type: integer
              nullable: true
    CouponResource:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - code
            - type
            - value
            - isActive
          properties:
            id:
              type: string
              format: cuid
            code:
              type: string
            description:
              type: string
              nullable: true
            type:
              type: string
              enum:
                - PERCENTAGE
                - FIXED_AMOUNT
                - FREE_SHIPPING
            value:
              $ref: "#/components/schemas/Money"
            minOrderAmount:
              $ref: "#/components/schemas/Money"
              nullable: true
            maxDiscountAmount:
              $ref: "#/components/schemas/Money"
              nullable: true
            usageLimit:
              type: integer
              nullable: true
            usageCount:
              type: integer
              minimum: 0
            startsAt:
              type: string
              format: date-time
              nullable: true
            expiresAt:
              type: string
              format: date-time
              nullable: true
            isActive:
              type: boolean
    CouponUsageRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - couponId
            - userId
            - orderId
            - discountAmount
            - usedAt
          properties:
            id:
              type: string
              format: cuid
            couponId:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
            orderId:
              type: string
              format: cuid
            discountAmount:
              $ref: "#/components/schemas/Money"
            usedAt:
              type: string
              format: date-time
    UserSessionToken:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - userId
            - refreshTokenHash
            - expiresAt
          properties:
            id:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
            refreshTokenHash:
              type: string
            fingerprint:
              type: string
              nullable: true
            ipAddress:
              type: string
              nullable: true
            userAgent:
              type: string
              nullable: true
            expiresAt:
              type: string
              format: date-time
            revokedAt:
              type: string
              format: date-time
              nullable: true
    SecurityEventRecord:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - type
          properties:
            id:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
              nullable: true
            type:
              type: string
            ipAddress:
              type: string
              nullable: true
            userAgent:
              type: string
              nullable: true
            payload:
              type: object
              additionalProperties: true
              nullable: true
    AuditLogEntry:
      allOf:
        - $ref: "#/components/schemas/AuditTimestamps"
        - type: object
          required:
            - id
            - actorType
            - action
            - entity
            - entityId
          properties:
            id:
              type: string
              format: cuid
            userId:
              type: string
              format: cuid
              nullable: true
            actorType:
              type: string
            action:
              type: string
            entity:
              type: string
            entityId:
              type: string
            before:
              type: object
              additionalProperties: true
              nullable: true
            after:
              type: object
              additionalProperties: true
              nullable: true
            ipAddress:
              type: string
              nullable: true
            userAgent:
              type: string
              nullable: true
    PaginationMeta:
      type: object
      required:
        - page
        - pageSize
        - totalItems
        - totalPages
        - hasNextPage
        - hasPreviousPage
      properties:
        page:
          type: integer
          minimum: 0
        pageSize:
          type: integer
          minimum: 1
        totalItems:
          type: integer
          minimum: 0
        totalPages:
          type: integer
          minimum: 0
        hasNextPage:
          type: boolean
        hasPreviousPage:
          type: boolean
paths:
  /api/v1/health:
    get:
      summary: Retrieve comprehensive service health
      description: >
        Aggregates component health checks, latency measurements, and process diagnostics to provide a production-grade
        snapshot of the service state.
      tags:
        - Health
      responses:
        "200":
          description: Service health snapshot available.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthComprehensiveResponse"
        "500":
          description: Failed to evaluate health checks or collect metrics.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/products:
    get:
      tags:
        - Catalog
      summary: List products
      description: >
        Returns a paginated product catalogue with filtering, sorting, and full-text search capabilities. Public
        endpoint with per-IP rate limiting (120 requests / 5 minutes).
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: perPage
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 24
        - name: sort
          in: query
          description: Sort key (`-createdAt`, `price`, `popularity`).
          schema:
            type: string
        - name: filter[category]
          in: query
          schema:
            type: string
        - name: filter[status]
          in: query
          schema:
            type: string
            enum:
              - ACTIVE
              - DRAFT
              - ARCHIVED
        - name: search
          in: query
          schema:
            type: string
        - $ref: "#/components/parameters/RequestIdHeader"
      responses:
        "200":
          description: Paginated products
          headers:
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Product"
        "429":
          description: Rate limit exceeded.
  /api/v1/products/popular:
    get:
      tags:
        - Catalog
      summary: List popular products
      description: Cached (60s TTL) curated list based on conversions and view metrics.
      responses:
        "200":
          description: Highlighted products
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: "#/components/schemas/Product"
  /api/v1/products/{slug}:
    get:
      tags:
        - Catalog
      summary: Get product by slug
      parameters:
        - $ref: "#/components/parameters/ProductSlug"
      responses:
        "200":
          description: Product found
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          product:
                            $ref: "#/components/schemas/Product"
        "404":
          description: Product not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/products/{id}/variants:
    get:
      tags:
        - Catalog
      summary: List variants
      parameters:
        - $ref: "#/components/parameters/ProductId"
      responses:
        "200":
          description: Product variants
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: "#/components/schemas/ProductVariant"
        "404":
          description: Product not found
  /api/v1/categories:
    get:
      tags:
        - Catalog
      summary: List categories
      description: Returns the category tree ordered by display priority.
      responses:
        "200":
          description: Categories fetched
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: "#/components/schemas/Category"
  /api/v1/categories/{slug}:
    get:
      tags:
        - Catalog
      summary: Get category by slug
      parameters:
        - $ref: "#/components/parameters/CategorySlug"
      responses:
        "200":
          description: Category found
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          category:
                            $ref: "#/components/schemas/Category"
        "404":
          description: Category not found
  /api/v1/admin/products:
    post:
      tags:
        - Catalog
        - Admin
      summary: Create product
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductCreateInput"
      responses:
        "201":
          description: Product created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          product:
                            $ref: "#/components/schemas/Product"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "403":
          $ref: "#/components/responses/ForbiddenError"
  /api/v1/admin/products/{id}:
    put:
      tags:
        - Catalog
        - Admin
      summary: Update product
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProductId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductUpdateInput"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          product:
                            $ref: "#/components/schemas/Product"
        "404":
          description: Product not found
    delete:
      tags:
        - Catalog
        - Admin
      summary: Soft delete product
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProductId"
      responses:
        "204":
          description: Deleted
  /api/v1/admin/products/{id}/variants:
    post:
      tags:
        - Catalog
        - Admin
      summary: Add variant
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProductId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductVariant"
      responses:
        "201":
          description: Variant created
  /api/v1/admin/products/{id}/variants/{variantId}:
    put:
      tags:
        - Catalog
        - Admin
      summary: Update variant
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProductId"
        - $ref: "#/components/parameters/VariantId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductVariant"
      responses:
        "200":
          description: Variant updated
    delete:
      tags:
        - Catalog
        - Admin
      summary: Remove variant
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProductId"
        - $ref: "#/components/parameters/VariantId"
      responses:
        "204":
          description: Variant deleted
  /api/v1/admin/categories:
    post:
      tags:
        - Catalog
        - Admin
      summary: Create category
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CategoryInput"
      responses:
        "201":
          description: Category created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          category:
                            $ref: "#/components/schemas/Category"
  /api/v1/admin/categories/{id}:
    put:
      tags:
        - Catalog
        - Admin
      summary: Update category
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/CategoryId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CategoryInput"
      responses:
        "200":
          description: Category updated
    delete:
      tags:
        - Catalog
        - Admin
      summary: Delete category
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/CategoryId"
      responses:
        "204":
          description: Category deleted
  /api/v1/cart:
    get:
      tags:
        - Cart
      summary: Retrieve current user's cart
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Active cart
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          cart:
                            $ref: "#/components/schemas/Cart"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
    delete:
      tags:
        - Cart
      summary: Clear cart
      security:
        - bearerAuth: []
      responses:
        "204":
          description: Cart cleared
  /api/v1/cart/items:
    post:
      tags:
        - Cart
      summary: Add or update line item
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CartItemInput"
      responses:
        "201":
          description: Item added
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          cart:
                            $ref: "#/components/schemas/Cart"
  /api/v1/cart/items/{itemId}:
    put:
      tags:
        - Cart
      summary: Update quantity
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/CartItemId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - quantity
              properties:
                quantity:
                  type: integer
                  minimum: 1
                  maximum: 20
      responses:
        "200":
          description: Updated
    delete:
      tags:
        - Cart
      summary: Remove item
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/CartItemId"
      responses:
        "204":
          description: Removed
  /api/v1/cart/merge:
    post:
      tags:
        - Cart
      summary: Merge guest cart
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CartMergeInput"
      responses:
        "200":
          description: Merged cart
  /api/v1/cart/validate:
    get:
      tags:
        - Cart
      summary: Validate cart before checkout
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Validation report
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/CartValidationResult"
  /api/v1/orders:
    post:
      tags:
        - Orders
      summary: Create order
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderCreateInput"
      responses:
        "201":
          description: Order created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          order:
                            $ref: "#/components/schemas/OrderDetail"
    get:
      tags:
        - Orders
      summary: List customer orders
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: perPage
          in: query
          schema:
            type: integer
            default: 10
            maximum: 50
        - name: status
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Orders page
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: "#/components/schemas/Order"
  /api/v1/orders/{id}:
    get:
      tags:
        - Orders
      summary: Get order details
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrderId"
      responses:
        "200":
          description: Order detail
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          order:
                            $ref: "#/components/schemas/OrderDetail"
        "404":
          description: Not found
  /api/v1/orders/{id}/cancel:
    put:
      tags:
        - Orders
      summary: Cancel order
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrderId"
      responses:
        "200":
          description: Cancelled
  /api/v1/orders/{reference}/track:
    get:
      tags:
        - Orders
      summary: Track order status via reference
      parameters:
        - $ref: "#/components/parameters/OrderReference"
      responses:
        "200":
          description: Tracking details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tracking:
                            $ref: "#/components/schemas/Tracking"
        "404":
          description: Not found
  /api/v1/admin/orders:
    get:
      tags:
        - Orders
        - Admin
      summary: List orders (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: perPage
          in: query
          schema:
            type: integer
            maximum: 100
        - name: status
          in: query
          schema:
            type: string
        - name: customerEmail
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Orders
  /api/v1/admin/orders/stats:
    get:
      tags:
        - Orders
        - Admin
      summary: Order KPIs
      security:
        - bearerAuth: []
      responses:
        "200":
          description: KPI snapshot
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/OrderStats"
  /api/v1/admin/orders/{id}:
    get:
      tags:
        - Orders
        - Admin
      summary: Get order (admin)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrderId"
      responses:
        "200":
          description: Order detail
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          order:
                            $ref: "#/components/schemas/OrderDetail"
  /api/v1/admin/orders/{id}/status:
    put:
      tags:
        - Orders
        - Admin
      summary: Update order status
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrderId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderStatusUpdateInput"
      responses:
        "200":
          description: Updated
  /api/v1/admin/orders/{id}/notes:
    post:
      tags:
        - Orders
        - Admin
      summary: Add order note
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrderId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderNoteInput"
      responses:
        "201":
          description: Note created
  /api/v1/admin/orders/{id}/refund:
    post:
      tags:
        - Orders
        - Admin
      summary: Process refund
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrderId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefundRequestInput"
      responses:
        "202":
          description: Refund initiated
  /api/v1/users/me:
    get:
      tags:
        - Users
      summary: Get authenticated profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Profile
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserProfile"
    put:
      tags:
        - Users
      summary: Update profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserProfileUpdateInput"
      responses:
        "200":
          description: Updated profile
  /api/v1/users/me/password:
    put:
      tags:
        - Users
      summary: Change password
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordInput"
      responses:
        "204":
          description: Password updated
  /api/v1/users/me/addresses:
    get:
      tags:
        - Users
      summary: List addresses
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Addresses
    post:
      tags:
        - Users
      summary: Create address
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddressInput"
      responses:
        "201":
          description: Address created
  /api/v1/users/me/addresses/{addressId}:
    put:
      tags:
        - Users
      summary: Update address
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/AddressId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddressInput"
      responses:
        "200":
          description: Address updated
    delete:
      tags:
        - Users
      summary: Delete address
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/AddressId"
      responses:
        "204":
          description: Address deleted
  /api/v1/users/me/addresses/{addressId}/default:
    put:
      tags:
        - Users
      summary: Set default address
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/AddressId"
      responses:
        "204":
          description: Default updated
  /api/v1/users/me/preferences:
    get:
      tags:
        - Users
      summary: Get preferences
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Preferences
    put:
      tags:
        - Users
      summary: Update preferences
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserPreferencesInput"
      responses:
        "200":
          description: Preferences updated
  /api/v1/admin/users:
    get:
      summary: List platform users (placeholder)
      description: >
        Administrative endpoints are guarded by RBAC. Until full implementations land, a placeholder payload is returned
        for authorised administrators.
      tags:
        - Admin
      security:
        - bearerAuth: []
        - serviceToken: []
      responses:
        "200":
          description: Successful placeholder payload for authorised administrators.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardSuccessResponse"
        "403":
          description: Administrator privileges are required or the requester lacks a valid role.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
    post:
      summary: Create a platform user (placeholder)
      description: >
        Placeholder endpoint for administrative user creation. Returns an informational message for authorised
        administrators.
      tags:
        - Admin
      security:
        - bearerAuth: []
        - serviceToken: []
      responses:
        "202":
          description: Request acknowledged for authorised administrators.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardSuccessResponse"
        "403":
          description: Administrator privileges are required or the requester lacks a valid role.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/admin/users/{id}:
    get:
      tags:
        - Users
        - Admin
      summary: Inspect user
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: User detail
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: "#/components/schemas/UserProfile"
  /api/v1/admin/users/{id}/status:
    put:
      tags:
        - Users
        - Admin
      summary: Update user status
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserStatusUpdateInput"
      responses:
        "200":
          description: Status updated
  /api/v1/admin/users/{id}/unlock:
    post:
      tags:
        - Users
        - Admin
      summary: Unlock user
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminUnlockUserInput"
      responses:
        "202":
          description: Unlock request accepted
  /api/v1/media:
    get:
      tags:
        - Media
      summary: List media assets
      description: >
        Returns a paginated list of Cloudinary-backed assets. Private and internal assets are returned only to the
        uploader or RBAC-approved operators. Responses include cache headers and strong ETags so the admin portal can
        poll efficiently.
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: perPage
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 24
        - name: folder
          in: query
          schema:
            type: string
          description: Restrict results to a specific Cloudinary folder (e.g., `lumi/products`).
        - name: resourceType
          in: query
          schema:
            type: string
            enum:
              - image
              - video
              - raw
        - name: tags
          in: query
          description: >
            Filter by tags (AND semantics). Repeat the parameter to provide multiple tags (e.g.,
            `tags=product:123&tags=hero`).
          schema:
            type: array
            items:
              type: string
          style: form
          explode: true
        - name: tag
          in: query
          schema:
            type: string
          description: Convenience alias for a single tag filter.
        - name: search
          in: query
          schema:
            type: string
            minLength: 2
            maxLength: 120
          description: Case-insensitive search across `publicId`, folder, and tags.
        - name: productId
          in: query
          schema:
            type: string
            format: cuid
        - name: productVariantId
          in: query
          schema:
            type: string
            format: cuid
        - name: uploadedById
          in: query
          schema:
            type: string
            format: cuid
        - name: includeDeleted
          in: query
          schema:
            type: boolean
          description: |
            When `true`, includes soft-deleted assets. Ignored unless the caller has the `admin` or `staff` role.
        - $ref: "#/components/parameters/RequestIdHeader"
      responses:
        "200":
          description: Paginated media assets
          headers:
            ETag:
              description: Strong validator representing the asset list snapshot.
              schema:
                type: string
            Cache-Control:
              description: Cache policy hint for CDN/CDP layers.
              schema:
                type: string
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/MediaAsset"
                      meta:
                        type: object
                        properties:
                          pagination:
                            $ref: "#/components/schemas/Pagination"
              examples:
                success:
                  $ref: "#/components/examples/MediaListSuccess"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
  /api/v1/media/upload:
    post:
      tags:
        - Media
      summary: Upload media assets
      description: >
        Accepts up to 10 files per request, enforces MIME/size policies, performs malware scanning, and stores the
        assets in Cloudinary with eager thumbnail/medium/large variants and responsive breakpoints.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - files
              properties:
                files:
                  type: array
                  minItems: 1
                  maxItems: 10
                  items:
                    type: string
                    format: binary
                  description: Image files (`image/jpeg`, `image/png`, `image/webp`, `image/gif`).
                folder:
                  type: string
                  description: |
                    Target Cloudinary folder. Must match an allow-listed value (e.g., `lumi/products`, `lumi/banners`).
                  example: lumi/products
                visibility:
                  type: string
                  enum:
                    - public
                    - private
                    - internal
                  default: public
                tags:
                  type: array
                  items:
                    type: string
                  description: Optional contextual tags (product, campaign, locale).
                metadata:
                  description: Optional JSON payload for alt text, captions, or custom fields.
                  oneOf:
                    - type: object
                      additionalProperties: true
                    - type: string
                      description: JSON string
            encoding:
              files:
                contentType: image/jpeg, image/png, image/webp, image/gif
                style: form
                explode: true
      responses:
        "200":
          description: Upload summary
          headers:
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MediaUploadResult"
                      meta:
                        $ref: "#/components/schemas/MediaUploadMeta"
              examples:
                success:
                  $ref: "#/components/examples/MediaUploadSuccess"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
              examples:
                validation:
                  $ref: "#/components/examples/ValidationError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "413":
          description: File too large
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
              examples:
                tooLarge:
                  $ref: "#/components/examples/MediaUploadPayloadTooLarge"
        "415":
          description: Unsupported MIME type
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
              examples:
                unsupported:
                  $ref: "#/components/examples/MediaUploadUnsupportedMime"
        "429":
          description: Upload rate limited
          headers:
            Retry-After:
              $ref: "#/components/headers/Retry-After"
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/admin/media/{id}:
    delete:
      tags:
        - Media
        - Admin
      summary: Soft delete media asset
      description: >
        Marks the asset as deleted and removes it from listings. Actual Cloudinary destruction happens through the
        follow-up cleanup job or the permanent delete endpoint. Requires `admin` or `staff`.
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MediaId"
        - $ref: "#/components/parameters/RequestIdHeader"
      responses:
        "200":
          description: Deleted asset snapshot
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardSuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MediaAsset"
              examples:
                success:
                  $ref: "#/components/examples/MediaAssetSuccess"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          description: Asset not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "409":
          description: Asset still referenced
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
              examples:
                conflict:
                  $ref: "#/components/examples/MediaDeleteConflict"
  /api/v1/auth/register:
    post:
      tags:
        - Auth
      summary: Register a new user account
      description: Creates a customer account and dispatches an email verification token. Passwords must satisfy the platform
        policy and are hashed before storage.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: Registration succeeded and a verification email was issued.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthRegisterResponse"
        "400":
          description: Validation failed for the supplied payload.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "409":
          description: An account with the provided email already exists.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/login:
    post:
      tags:
        - Auth
      summary: Authenticate with email and password
      description: Validates credentials, records security telemetry, issues a new session, and returns access/refresh tokens.
        The refresh token is also delivered as an HTTP-only, same-site cookie.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login succeeded and tokens were issued.
          headers:
            Set-Cookie:
              description: Signed `refreshToken` cookie scoped to `/api` with SameSite=strict.
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthLoginResponse"
        "400":
          description: Validation failed for the credentials payload.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "401":
          description: Invalid credentials, lockout in effect, or account inactive.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/refresh:
    post:
      tags:
        - Auth
      summary: Rotate refresh token and obtain a new access token
      description: Expects a valid signed refresh token via HTTP-only cookies. Performs replay detection, rotates the session,
        and returns a fresh token pair.
      responses:
        "200":
          description: Token rotation succeeded.
          headers:
            Set-Cookie:
              description: Signed `refreshToken` cookie scoped to `/api` with SameSite=strict.
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthRefreshResponse"
        "401":
          description: Missing refresh token, token reuse detected, or session no longer valid.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/logout:
    post:
      tags:
        - Auth
      summary: Revoke the current session
      description: Invalidates the active session and clears the refresh token cookie.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Session revoked successfully.
          headers:
            Set-Cookie:
              description: Refresh token cookie cleared by setting an expired value.
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthLogoutResponse"
        "401":
          description: Caller is not authenticated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/logout-all:
    post:
      tags:
        - Auth
      summary: Revoke all sessions for the authenticated user
      description: Invalidates every active session associated with the caller and clears the refresh cookie.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Active sessions revoked.
          headers:
            Set-Cookie:
              description: Refresh token cookie cleared by setting an expired value.
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthLogoutAllResponse"
        "401":
          description: Caller is not authenticated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/me:
    get:
      tags:
        - Auth
      summary: Retrieve the authenticated user profile
      description: Returns the caller's profile, including roles and permissions resolved through RBAC.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Profile retrieved.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponse"
        "401":
          description: Caller is not authenticated or session is invalid.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/verify-email:
    post:
      tags:
        - Auth
      summary: Confirm email using a verification token
      description: Validates the verification token delivered by email, marks the user as verified, and revokes sessions if
        token misuse is detected.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyEmailRequest"
      responses:
        "200":
          description: Email verified successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponse"
        "400":
          description: Token structure invalid or already consumed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "401":
          description: Token signature mismatch or verification failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/resend-verification:
    post:
      tags:
        - Auth
      summary: Resend email verification for the authenticated user
      description: Issues a new verification token provided the account is not already verified.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Verification email reissued.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponse"
        "401":
          description: Caller is not authenticated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "404":
          description: User record could not be found (should not occur for authenticated clients).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "409":
          description: Email is already verified.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "429":
          description: Rate limit exceeded for resend requests.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/forgot-password:
    post:
      tags:
        - Auth
      summary: Initiate password reset
      description: Sends a password reset email if the account exists. The response is intentionally generic to avoid user
        enumeration.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        "200":
          description: Reset workflow triggered if the account exists.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthMessageResponse"
        "400":
          description: Email field missing or invalid.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "429":
          description: Rate limit exceeded for password reset requests.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/reset-password:
    post:
      tags:
        - Auth
      summary: Complete password reset
      description: Validates the reset token, updates the password, revokes active sessions, and logs a security event.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          description: Password updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponse"
        "400":
          description: Payload validation failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "401":
          description: Token mismatch or expired.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/change-password:
    put:
      tags:
        - Auth
      summary: Change password for the authenticated user
      description: Validates the current password, enforces the password policy, updates stored credentials, and revokes other
        sessions.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: Password updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponse"
        "400":
          description: Validation failed (policy breach or passwords identical).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "401":
          description: Authentication failed or current password incorrect.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "429":
          description: Rate limit exceeded for change password attempts.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/2fa/setup:
    post:
      tags:
        - Auth
      summary: Placeholder endpoint for two-factor enrolment
      description: Currently returns a NOT_IMPLEMENTED response while the two-factor flow is under construction. Available to
        authenticated callers for roadmap awareness.
      security:
        - bearerAuth: []
      responses:
        "401":
          description: Caller is not authenticated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "501":
          description: Feature not yet implemented.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/auth/2fa/verify:
    post:
      tags:
        - Auth
      summary: Placeholder endpoint for two-factor verification
      description: Returns NOT_IMPLEMENTED until two-factor verification is released. Helps clients detect feature availability.
      security:
        - bearerAuth: []
      responses:
        "401":
          description: Caller is not authenticated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "501":
          description: Feature not yet implemented.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/admin/audit-log:
    get:
      summary: Retrieve audit log entries (placeholder)
      description: >
        Enterprise audit trails will be exposed here after RBAC implementation. Authorised administrators receive a
        placeholder payload.
      tags:
        - Admin
      security:
        - bearerAuth: []
        - serviceToken: []
      responses:
        "200":
          description: Placeholder payload for authorised administrators.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardSuccessResponse"
        "403":
          description: Administrator privileges are required or ownership checks failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/admin/reports/sales:
    get:
      summary: Generate sales report (placeholder)
      description: >
        Reserved endpoint for future sales reporting capabilities. Authorised administrators with reporting permissions
        receive a placeholder payload.
      tags:
        - Admin
      security:
        - bearerAuth: []
        - serviceToken: []
      responses:
        "200":
          description: Placeholder payload for authorised administrators with reporting access.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardSuccessResponse"
        "403":
          description: Administrator privileges or reporting permissions are missing.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/health/ready:
    get:
      summary: Readiness probe
      description: Evaluates dependency health to determine whether the service can accept traffic.
      tags:
        - Health
      responses:
        "200":
          description: Service is ready to accept traffic.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthReadinessResponse"
        "503":
          description: One or more dependencies are unhealthy; traffic should not yet be routed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
  /api/v1/health/live:
    get:
      summary: Liveness probe
      description: Lightweight probe used by orchestrators to confirm the process is responsive.
      tags:
        - Health
      responses:
        "200":
          description: Service process is healthy and responsive.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthLivenessResponse"
  /internal/metrics:
    get:
      summary: Export Prometheus metrics snapshot
      description: >
        Streams Prometheus-compatible metrics. The endpoint requires Basic authentication when enabled in configuration
        and is intended for platform observability tooling.
      tags:
        - Observability
      security:
        - basicAuth: []
      responses:
        "200":
          description: OpenMetrics stream containing the latest metrics.
          content:
            text/plain:
              schema:
                type: string
        "204":
          description: Metrics collection enabled but no datapoints have been recorded yet.
        "401":
          description: Authentication is required to access metrics.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "500":
          description: Failed to collect the metrics snapshot.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
        "503":
          description: Metrics collection is disabled in the active configuration.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardErrorResponse"
