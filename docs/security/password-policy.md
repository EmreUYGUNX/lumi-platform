# Password Security Policy

This policy defines Lumi’s enterprise-grade password requirements and explains how they are enforced across the platform. It satisfies Phase 3 (Authentication & RBAC) deliverables for documented password practices and maintains S1 compliance.

## 1. Policy Summary

- **Hashing algorithm**: bcrypt (cost factor ≥ 12) using the `bcryptjs` implementation.
- **Plain-text passwords**: Never stored or logged; only salted hashes are persisted.
- **Scope**: Applies to all user-facing authentication flows (customers, admins, partners) and internal service accounts created through the management APIs.
- **Rotation**: User-initiated only; administrative resets follow the secure reset workflow (Phase 3 requirement).

## 2. Complexity Requirements

Passwords must satisfy all of the following:

1. Minimum length of **12 characters**.
2. At least **one uppercase** letter (`A-Z`).
3. At least **one lowercase** letter (`a-z`).
4. At least **one numeral** (`0-9`).
5. At least **one special character** (any non-alphanumeric symbol).

The password validator implemented in `apps/backend/src/lib/crypto/password.ts` enforces these rules. Validation occurs before any hash is generated or written to persistent storage.

## 3. Enforcement & Verification

- `hashPassword(password)` hashes credentials with bcrypt cost factor `12` by default.
- `verifyPassword(password, hash)` compares credentials using bcrypt’s timing-safe comparison.
- `timingSafeStringCompare(a, b)` is available for constant-time comparisons when hashes must be checked manually (e.g., verification tokens).
- `validatePasswordStrength(password)` returns structured feedback containing the specific violated rules (`min_length`, `uppercase`, `lowercase`, `number`, `special`).

Unit tests under `apps/backend/src/lib/__tests__/crypto/password.jest.spec.ts` assert the bcrypt cost factor, ensure plain-text values are never returned, and cover every validation rule.

## 4. Optional Breach Checks

The implementation is structured to support haveibeenpwned (HIBP) lookups. When enabled, validate passwords against HIBP’s k-anonymity API after local complexity checks and reject compromised credentials without storing the attempted value.

## 5. Developer Guidance

- Always run `validatePasswordStrength` before calling `hashPassword`.
- Do not introduce alternative hashing algorithms without a security review.
- When adjusting policies (e.g., increasing minimum length), update `DEFAULT_PASSWORD_POLICY`, regenerate related documentation, and extend the unit test matrix.
- For service-to-service credentials that cannot meet complexity requirements (e.g., secrets generated by third parties), enforce random generation with equivalent entropy and store them in Vault rather than applying user password rules.

## 6. References

- Phase 0 S1 baseline (`PHASE-0-FOUNDATION-SETUP.md`)
- Phase 3 Authentication & RBAC checklist (`PHASE-3-AUTHENTICATION-RBAC.md`)
- OWASP ASVS 4.0 – Section V2 (Authentication)
- NIST SP 800-63B – Digital Identity Guidelines
